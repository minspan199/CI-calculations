clc
clear all
close all

Data = [1.51000000000000e-07 + 0.00000000000000i,0.232384644665414 + 0.0131768131867795i;1.52000000000000e-07 + 0.00000000000000i,0.364782870366186 + 0.00941556103358770i;1.53000000000000e-07 + 0.00000000000000i,0.459505669255530 + 0.00826117580800981i;1.54000000000000e-07 + 0.00000000000000i,0.536870936351499 + 0.00772278826463858i;1.55000000000000e-07 + 0.00000000000000i,0.603574586948632 + 0.00742990766291815i;1.56000000000000e-07 + 0.00000000000000i,0.662885910052350 + 0.00725838418123802i;1.57000000000000e-07 + 0.00000000000000i,0.716628659666895 + 0.00715435014842322i;1.58000000000000e-07 + 0.00000000000000i,0.765991826364074 + 0.00709052617699075i;1.59000000000000e-07 + 0.00000000000000i,0.811766946610168 + 0.00705459372407791i;1.60000000000000e-07 + 0.00000000000000i,0.854543104174928 + 0.00704488253561468i;1.61000000000000e-07 + 0.00000000000000i,0.894723888951115 + 0.00706127358513606i;1.62000000000000e-07 + 0.00000000000000i,0.932599529816639 + 0.00708275040139786i;1.63000000000000e-07 + 0.00000000000000i,0.968392976863859 + 0.00706878993107402i;1.64000000000000e-07 + 0.00000000000000i,1.00224407486971 + 0.00697676599501068i;1.65000000000000e-07 + 0.00000000000000i,1.03413303374907 + 0.00672307213605361i;1.66000000000000e-07 + 0.00000000000000i,1.06379721661313 + 0.00612765517214721i;1.67000000000000e-07 + 0.00000000000000i,1.09059720771693 + 0.00510217205357987i;1.68000000000000e-07 + 0.00000000000000i,1.13383284395387 + 0.00597324681864298i;1.69000000000000e-07 + 0.00000000000000i,1.16045716306945 + 0.00655964108795849i;1.70000000000000e-07 + 0.00000000000000i,1.18674455817233 + 0.00687316569881238i;1.71000000000000e-07 + 0.00000000000000i,1.21243870498699 + 0.00705792269771106i;1.72000000000000e-07 + 0.00000000000000i,1.23744030600522 + 0.00717972412574352i;1.73000000000000e-07 + 0.00000000000000i,1.26175176302554 + 0.00726841267712714i;1.74000000000000e-07 + 0.00000000000000i,1.28538453243386 + 0.00733808170097635i;1.75000000000000e-07 + 0.00000000000000i,1.30836124571236 + 0.00739597927505729i;1.76000000000000e-07 + 0.00000000000000i,1.33071222591731 + 0.00744593703229352i;1.77000000000000e-07 + 0.00000000000000i,1.35245907932483 + 0.00749034501036512i;1.78000000000000e-07 + 0.00000000000000i,1.37363541783401 + 0.00753094384465682i;1.79000000000000e-07 + 0.00000000000000i,1.39427019756333 + 0.00756845163232419i;1.80000000000000e-07 + 0.00000000000000i,1.41437815437190 + 0.00760340413233383i;1.81000000000000e-07 + 0.00000000000000i,1.43399760510053 + 0.00763656090559306i;1.82000000000000e-07 + 0.00000000000000i,1.45314305371207 + 0.00766797408632598i;1.83000000000000e-07 + 0.00000000000000i,1.47183288147108 + 0.00769791595770922i;1.84000000000000e-07 + 0.00000000000000i,1.49008750890006 + 0.00772651262837532i;1.85000000000000e-07 + 0.00000000000000i,1.50793230387555 + 0.00775402379894628i;1.86000000000000e-07 + 0.00000000000000i,1.52537612961960 + 0.00778046834558362i;1.87000000000000e-07 + 0.00000000000000i,1.54244457682364 + 0.00780609383688042i;1.88000000000000e-07 + 0.00000000000000i,1.55914118093744 + 0.00783081316461094i;1.89000000000000e-07 + 0.00000000000000i,1.57548894325335 + 0.00785477091884401i;1.90000000000000e-07 + 0.00000000000000i,1.59149492284157 + 0.00787785362242042i;1.91000000000000e-07 + 0.00000000000000i,1.60716933310410 + 0.00790016881450858i;1.92000000000000e-07 + 0.00000000000000i,1.62253737301651 + 0.00792195684371949i;1.93000000000000e-07 + 0.00000000000000i,1.63759855443394 + 0.00794310620078814i;1.94000000000000e-07 + 0.00000000000000i,1.65236661241896 + 0.00796359951683795i;1.95000000000000e-07 + 0.00000000000000i,1.66685407452720 + 0.00798357076896262i;1.96000000000000e-07 + 0.00000000000000i,1.68106243367094 + 0.00800287285406778i;1.97000000000000e-07 + 0.00000000000000i,1.69500965588283 + 0.00802173439741401i;1.98000000000000e-07 + 0.00000000000000i,1.70869975020193 + 0.00804007953962793i;1.99000000000000e-07 + 0.00000000000000i,1.72214054363331 + 0.00805781224599282i;2.00000000000000e-07 + 0.00000000000000i,1.73534023064641 + 0.00807517890057486i;2.01000000000000e-07 + 0.00000000000000i,1.74830868294757 + 0.00809204597100778i;2.02000000000000e-07 + 0.00000000000000i,1.76104697772265 + 0.00810844642513505i;2.03000000000000e-07 + 0.00000000000000i,1.77356790502694 + 0.00812444335480143i;2.04000000000000e-07 + 0.00000000000000i,1.78587467147519 + 0.00814007198944721i;2.05000000000000e-07 + 0.00000000000000i,1.79797453110562 + 0.00815526327083264i;2.06000000000000e-07 + 0.00000000000000i,1.80987301106080 + 0.00817005507523640i;2.07000000000000e-07 + 0.00000000000000i,1.82157489072823 + 0.00818445595026141i;2.08000000000000e-07 + 0.00000000000000i,1.83308749335371 + 0.00819854155084448i;2.09000000000000e-07 + 0.00000000000000i,1.84441479568754 + 0.00821225915684140i;2.10000000000000e-07 + 0.00000000000000i,1.85556119163674 + 0.00822564960358216i;2.11000000000000e-07 + 0.00000000000000i,1.86652899468710 + 0.00823865900822975i;2.12000000000000e-07 + 0.00000000000000i,1.87732918492451 + 0.00825140723551938i;2.13000000000000e-07 + 0.00000000000000i,1.88795973741103 + 0.00826382676071666i;2.14000000000000e-07 + 0.00000000000000i,1.89842829480249 + 0.00827588966881131i;2.15000000000000e-07 + 0.00000000000000i,1.90873841461719 + 0.00828771627288013i;2.16000000000000e-07 + 0.00000000000000i,1.91889307925080 + 0.00829922492909799i;2.17000000000000e-07 + 0.00000000000000i,1.92889742258642 + 0.00831054388100584i;2.18000000000000e-07 + 0.00000000000000i,1.93875368297827 + 0.00832154798959500i;2.19000000000000e-07 + 0.00000000000000i,1.94846607956420 + 0.00833225676941609i;2.20000000000000e-07 + 0.00000000000000i,1.95803632625398 + 0.00834271333261727i;2.21000000000000e-07 + 0.00000000000000i,1.96747015141739 + 0.00835296438858755i;2.22000000000000e-07 + 0.00000000000000i,1.97676994413127 + 0.00836292582788682i;2.23000000000000e-07 + 0.00000000000000i,1.98593641813542 + 0.00837263158198806i;2.24000000000000e-07 + 0.00000000000000i,1.99497704002701 + 0.00838215956320713i;2.25000000000000e-07 + 0.00000000000000i,2.00388798835460 + 0.00839141613506709i;2.26000000000000e-07 + 0.00000000000000i,2.01268064387251 + 0.00840054435048670i;2.27000000000000e-07 + 0.00000000000000i,2.02135101381620 + 0.00840942585783691i;2.28000000000000e-07 + 0.00000000000000i,2.02990625124201 + 0.00841812347675993i;2.29000000000000e-07 + 0.00000000000000i,2.03834237261054 + 0.00842657465879351i;2.30000000000000e-07 + 0.00000000000000i,2.04666741931676 + 0.00843487413253335i;2.31000000000000e-07 + 0.00000000000000i,2.05488191006260 + 0.00844295386339754i;2.32000000000000e-07 + 0.00000000000000i,2.06298612244071 + 0.00845077464214404i;2.33000000000000e-07 + 0.00000000000000i,2.07098747214819 + 0.00845861597880531i;2.34000000000000e-07 + 0.00000000000000i,2.07888518424892 + 0.00846609991412357i;2.35000000000000e-07 + 0.00000000000000i,2.08667929240890 + 0.00847345359317318i;2.36000000000000e-07 + 0.00000000000000i,2.09437473599323 + 0.00848070893286687i;2.37000000000000e-07 + 0.00000000000000i,2.10197197384797 + 0.00848775992931206i;2.38000000000000e-07 + 0.00000000000000i,2.10947355778764 + 0.00849464423374356i;2.39000000000000e-07 + 0.00000000000000i,2.11687941528673 + 0.00850135164573136i;2.40000000000000e-07 + 0.00000000000000i,2.12410418670387 + 0.00850491312974329i;2.42000000000000e-07 + 0.00000000000000i,2.13846491253968 + 0.00851760347198956i;2.44000000000000e-07 + 0.00000000000000i,2.15248060227299 + 0.00852998782319194i;2.46000000000000e-07 + 0.00000000000000i,2.16616018572974 + 0.00854159250843219i;2.48000000000000e-07 + 0.00000000000000i,2.17951314722170 + 0.00855277695068815i;2.50000000000000e-07 + 0.00000000000000i,2.19255220784483 + 0.00856340062730646i;2.52000000000000e-07 + 0.00000000000000i,2.20529279341556 + 0.00857363086267522i;2.54000000000000e-07 + 0.00000000000000i,2.21773951337259 + 0.00858339109737525i;2.56000000000000e-07 + 0.00000000000000i,2.22990317544522 + 0.00859266397086981i;2.58000000000000e-07 + 0.00000000000000i,2.24179633729569 + 0.00860154565492640i;2.60000000000000e-07 + 0.00000000000000i,2.25342937830240 + 0.00861013920673888i;2.62000000000000e-07 + 0.00000000000000i,2.26480588066481 + 0.00861828499588480i;2.64000000000000e-07 + 0.00000000000000i,2.27593557194090 + 0.00862604133538920i;2.66000000000000e-07 + 0.00000000000000i,2.28682681300311 + 0.00863347711956097i;2.68000000000000e-07 + 0.00000000000000i,2.29748532939550 + 0.00864056483815338i;2.70000000000000e-07 + 0.00000000000000i,2.30792305806796 + 0.00864732439656820i;2.72000000000000e-07 + 0.00000000000000i,2.31814247082982 + 0.00865383391364399i;2.74000000000000e-07 + 0.00000000000000i,2.32815306873060 + 0.00866009685632911i;2.76000000000000e-07 + 0.00000000000000i,2.33795427292904 + 0.00866592875568719i;2.78000000000000e-07 + 0.00000000000000i,2.34756080648361 + 0.00867160714164360i;2.80000000000000e-07 + 0.00000000000000i,2.35697381378518 + 0.00867697006751285i;2.82000000000000e-07 + 0.00000000000000i,2.36619943080930 + 0.00868210128895951i;2.84000000000000e-07 + 0.00000000000000i,2.37524499007923 + 0.00868705664161449i;2.86000000000000e-07 + 0.00000000000000i,2.38411475164330 + 0.00869178843385348i;2.88000000000000e-07 + 0.00000000000000i,2.39280921420552 + 0.00869619517881461i;2.90000000000000e-07 + 0.00000000000000i,2.40134051485658 + 0.00870047008557239i;2.92000000000000e-07 + 0.00000000000000i,2.40970623327609 + 0.00870449379592048i;2.94000000000000e-07 + 0.00000000000000i,2.41791552270485 + 0.00870834978456715i;2.96000000000000e-07 + 0.00000000000000i,2.42597265120110 + 0.00871199291113285i;2.98000000000000e-07 + 0.00000000000000i,2.43387904243148 + 0.00871550659433530i;3.00000000000000e-07 + 0.00000000000000i,2.44164109227652 + 0.00871884639016940i;3.02000000000000e-07 + 0.00000000000000i,2.44926004319939 + 0.00872200154528829i;3.04000000000000e-07 + 0.00000000000000i,2.45674184337512 + 0.00872503366257772i;3.06000000000000e-07 + 0.00000000000000i,2.46408851505200 + 0.00872788136714184i;3.08000000000000e-07 + 0.00000000000000i,2.47130427338202 + 0.00873059286535243i;3.10000000000000e-07 + 0.00000000000000i,2.47839267803903 + 0.00873317213909012i;3.12000000000000e-07 + 0.00000000000000i,2.48535472187025 + 0.00873558544747452i;3.14000000000000e-07 + 0.00000000000000i,2.49219547719354 + 0.00873788137264142i;3.16000000000000e-07 + 0.00000000000000i,2.49891997317532 + 0.00874006783085171i;3.18000000000000e-07 + 0.00000000000000i,2.50552613443390 + 0.00874207448114603i;3.20000000000000e-07 + 0.00000000000000i,2.51202284126920 + 0.00874404291183921i;3.22000000000000e-07 + 0.00000000000000i,2.51840609872160 + 0.00874583454312404i;3.24000000000000e-07 + 0.00000000000000i,2.52468292919806 + 0.00874754347419314i;3.26000000000000e-07 + 0.00000000000000i,2.53085533016945 + 0.00874916661577220i;3.28000000000000e-07 + 0.00000000000000i,2.53692468256055 + 0.00875066555307459i;3.30000000000000e-07 + 0.00000000000000i,2.54289277792230 + 0.00875206401154442i;3.32000000000000e-07 + 0.00000000000000i,2.54876465507955 + 0.00875340262810683i;3.34000000000000e-07 + 0.00000000000000i,2.55453946712342 + 0.00875459956806960i;3.36000000000000e-07 + 0.00000000000000i,2.56022228526355 + 0.00875575408679078i;3.38000000000000e-07 + 0.00000000000000i,2.56581339039808 + 0.00875682563105515i;3.40000000000000e-07 + 0.00000000000000i,2.57131546629160 + 0.00875780931124347i;3.42000000000000e-07 + 0.00000000000000i,2.57672953063420 + 0.00875871037267854i;3.44000000000000e-07 + 0.00000000000000i,2.58205895518006 + 0.00875953468584265i;3.46000000000000e-07 + 0.00000000000000i,2.58730516248100 + 0.00876029539150388i;3.48000000000000e-07 + 0.00000000000000i,2.59246856801755 + 0.00876095063910515i;3.50000000000000e-07 + 0.00000000000000i,2.59755265870497 + 0.00876159346614392i;3.52000000000000e-07 + 0.00000000000000i,2.60255771342798 + 0.00876212358864148i;3.54000000000000e-07 + 0.00000000000000i,2.60748784840919 + 0.00876264594492004i;3.56000000000000e-07 + 0.00000000000000i,2.61234195501817 + 0.00876307439299750i;3.58000000000000e-07 + 0.00000000000000i,2.61712241544795 + 0.00876344157869176i;3.60000000000000e-07 + 0.00000000000000i,2.62183195170669 + 0.00876376628794860i;3.62000000000000e-07 + 0.00000000000000i,2.62647051042857 + 0.00876403246745537i;3.64000000000000e-07 + 0.00000000000000i,2.63103991503841 + 0.00876421681737514i;3.66000000000000e-07 + 0.00000000000000i,2.63554282334097 + 0.00876437957674688i;3.68000000000000e-07 + 0.00000000000000i,2.63998000298381 + 0.00876453160862117i;3.70000000000000e-07 + 0.00000000000000i,2.64435104432142 + 0.00876456875124605i;3.72000000000000e-07 + 0.00000000000000i,2.64866024336175 + 0.00876462003196378i;3.74000000000000e-07 + 0.00000000000000i,2.65290626795632 + 0.00876458839602402i;3.76000000000000e-07 + 0.00000000000000i,2.65709111438944 + 0.00876453299031357i;3.78000000000000e-07 + 0.00000000000000i,2.66121649620779 + 0.00876443414485377i;3.80000000000000e-07 + 0.00000000000000i,2.66528355623368 + 0.00876429164385545i;3.82000000000000e-07 + 0.00000000000000i,2.66929298473378 + 0.00876411687148695i;3.84000000000000e-07 + 0.00000000000000i,2.67324613419167 + 0.00876391300483563i;3.86000000000000e-07 + 0.00000000000000i,2.67714463510647 + 0.00876367084278217i;3.88000000000000e-07 + 0.00000000000000i,2.68098839716384 + 0.00876339469044586i;3.90000000000000e-07 + 0.00000000000000i,2.68477883923100 + 0.00876307633931872i;3.92000000000000e-07 + 0.00000000000000i,2.68851811421754 + 0.00876275833549580i;3.94000000000000e-07 + 0.00000000000000i,2.69220555445377 + 0.00876237943107906i;3.96000000000000e-07 + 0.00000000000000i,2.69584339261784 + 0.00876199030494124i;3.98000000000000e-07 + 0.00000000000000i,2.69943222336860 + 0.00876156863315765i;4.00000000000000e-07 + 0.00000000000000i,2.70297117952017 + 0.00876109237191741i];
d = Data(:,1);neff = (Data(:,2));perm = neff.^2;

figure;
yyaxis right;
plot(d*1e9,abs(real(perm)));
set(gcf, 'Position', [00, 00, 400, 300]);
ylabel('Real permittivity');
xlabel('Waveguide width');
yyaxis left;
hold on;
plot(d*1e9,imag(perm));
ylabel('Imaginary permittivity');
xlabel('Waveguide width');
legend(["Imaginary permittivity","Real permittivity"]);
title('150nm InP Left');
xlim([130 500]);

k0 = 2*pi/1550e-5;
L = 20e-6;
M = 300;
ne = 2.6;
z = -L/2:(L/(M - 1)):L/2;
wz = 2*ne*z/L;
permz = wz.^2;
figure;
plot(z,permz);

for ind = 1:1:M
    [~,inx] = min(abs((real(permz(ind) - perm)))); 
    d_Al(ind) = d(inx); 
    eps(ind) = perm(inx); 
end

figure;
yyaxis left;
plot(z*1e6,real(eps));
set(gcf, 'Position', [00, 00, 400, 300]);
xlabel('x(\mum)');
ylabel('Re[\epsilon]');
yyaxis right
plot(z*1e6,imag(eps));
set(gcf, 'Position', [00, 00, 400, 300]);
xlabel('x(\mum)');
ylabel('Im[\epsilon]');

figure;
plot(z*1e6,d_Al*1e9);
set(gcf, 'Position', [00, 00, 400, 300]);
xlabel('x(\mum)');
ylabel('Waveguide width(nm)')

figure;
plot(z,imag(eps))

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%For Comsol Geometry
% a = 0.181/0.161 - 1;
a = 0.161/0.161 - 1;
gc = -a*(abs(2*z/L)).^2 + a + 1;
Al_Y = [d_Al.*gc*1e6 -d_Al.*gc*1e6]/2;
Al_Y_h = Al_Y';
Al_Z = [z -z]*1e6;
Al_Z_h = Al_Z';
% Al_Y = [d_Al-0.0e-6 -d_Al+0.0e-6]/2*1e6;Al_Z = [z -z]*1e6;
% PumpSweep = unique(Lx_Al_Com)*1e9;
SiO_Y = [d_Al + 60e-9 -d_Al - 60e-9]/2*1e6;
SiO_Z = [z -z];


% % %%%%3.3^2 +(0.03*exp(-((z-5.168[um])/2[um])^2) + 0.03*exp(-((z+5.168[um])/2[um])^2) + 0.017*exp(-(z/10[um])^2))*i
% % tm = 0.03*exp(-((z-5.168e-6)/2e-6).^2) + 0.03*exp(-((z+5.168e-6)/2e-6).^2) + 0.017*exp(-(z/10e-6).^2);
% % figure
% % plot(z,tm)