clc
clear all
close all

Data = [1.50000000000000e-07 + 0.00000000000000i,0.296929110080881 + 0.00870026644702780i;1.51000000000000e-07 + 0.00000000000000i,0.409942722229218 + 0.00714021620014337i;1.52000000000000e-07 + 0.00000000000000i,0.496857213266682 + 0.00655971851228864i;1.53000000000000e-07 + 0.00000000000000i,0.569790961198507 + 0.00627828275793610i;1.54000000000000e-07 + 0.00000000000000i,0.633606282071667 + 0.00612057319390529i;1.55000000000000e-07 + 0.00000000000000i,0.690839544819743 + 0.00601743895656680i;1.56000000000000e-07 + 0.00000000000000i,0.743047077884446 + 0.00593739150839949i;1.57000000000000e-07 + 0.00000000000000i,0.791258164397842 + 0.00587212907059309i;1.58000000000000e-07 + 0.00000000000000i,0.836156490776801 + 0.00585115485243832i;1.59000000000000e-07 + 0.00000000000000i,0.878272772140661 + 0.00596566518725320i;1.60000000000000e-07 + 0.00000000000000i,0.917774121029187 + 0.00620749540883221i;1.61000000000000e-07 + 0.00000000000000i,0.954832876239747 + 0.00636627262533197i;1.62000000000000e-07 + 0.00000000000000i,0.989690394876980 + 0.00627031540224104i;1.63000000000000e-07 + 0.00000000000000i,1.02229586248864 + 0.00566963406265145i;1.64000000000000e-07 + 0.00000000000000i,1.05181638063460 + 0.00402480104323822i;1.65000000000000e-07 + 0.00000000000000i,1.09371676873696 + 0.00439640298656454i;1.66000000000000e-07 + 0.00000000000000i,1.12253036568639 + 0.00549372177343711i;1.67000000000000e-07 + 0.00000000000000i,1.15077764898422 + 0.00600141982488568i;1.68000000000000e-07 + 0.00000000000000i,1.17822883430758 + 0.00627922832472313i;1.69000000000000e-07 + 0.00000000000000i,1.20484886499354 + 0.00645482902768146i;1.70000000000000e-07 + 0.00000000000000i,1.23066433831512 + 0.00657883610868182i;1.71000000000000e-07 + 0.00000000000000i,1.25568900527089 + 0.00667385460905150i;1.72000000000000e-07 + 0.00000000000000i,1.27996419969558 + 0.00675104437129421i;1.73000000000000e-07 + 0.00000000000000i,1.30353649577217 + 0.00681676815556597i;1.74000000000000e-07 + 0.00000000000000i,1.32644511746286 + 0.00687478582287891i;1.75000000000000e-07 + 0.00000000000000i,1.34871396997187 + 0.00692680659573866i;1.76000000000000e-07 + 0.00000000000000i,1.37038551695362 + 0.00697444522880802i;1.77000000000000e-07 + 0.00000000000000i,1.39147851801252 + 0.00701852374750295i;1.78000000000000e-07 + 0.00000000000000i,1.41203570250341 + 0.00705987568269223i;1.79000000000000e-07 + 0.00000000000000i,1.43207401993564 + 0.00709892452819216i;1.80000000000000e-07 + 0.00000000000000i,1.45161146940179 + 0.00713576119004864i;1.81000000000000e-07 + 0.00000000000000i,1.47069054133523 + 0.00717111671303988i;1.82000000000000e-07 + 0.00000000000000i,1.48932009817363 + 0.00720518394099597i;1.83000000000000e-07 + 0.00000000000000i,1.50751812298211 + 0.00723754548516319i;1.84000000000000e-07 + 0.00000000000000i,1.52529983428979 + 0.00726848194834916i;1.85000000000000e-07 + 0.00000000000000i,1.54269618242678 + 0.00729860464809590i;1.86000000000000e-07 + 0.00000000000000i,1.55970553031546 + 0.00732745371464497i;1.87000000000000e-07 + 0.00000000000000i,1.57635657887105 + 0.00735536445243360i;1.88000000000000e-07 + 0.00000000000000i,1.59265492231690 + 0.00738248368044861i;1.89000000000000e-07 + 0.00000000000000i,1.60861717998564 + 0.00740858434908281i;1.90000000000000e-07 + 0.00000000000000i,1.62425880928104 + 0.00743400313115586i;1.91000000000000e-07 + 0.00000000000000i,1.63958200893508 + 0.00745850931092144i;1.92000000000000e-07 + 0.00000000000000i,1.65460311859804 + 0.00748228483602209i;1.93000000000000e-07 + 0.00000000000000i,1.66933733884188 + 0.00750552303277915i;1.94000000000000e-07 + 0.00000000000000i,1.68378645828299 + 0.00752795362327535i;1.95000000000000e-07 + 0.00000000000000i,1.69797003391542 + 0.00754972447807559i;1.96000000000000e-07 + 0.00000000000000i,1.71188493589385 + 0.00757091276719705i;1.97000000000000e-07 + 0.00000000000000i,1.72554435468161 + 0.00759158815405971i;1.98000000000000e-07 + 0.00000000000000i,1.73895579435288 + 0.00761156618703198i;1.99000000000000e-07 + 0.00000000000000i,1.75212496783996 + 0.00763099359172980i;2.00000000000000e-07 + 0.00000000000000i,1.76507346595907 + 0.00765022071977366i;2.01000000000000e-07 + 0.00000000000000i,1.77779101399971 + 0.00766877412827463i;2.02000000000000e-07 + 0.00000000000000i,1.79028344834992 + 0.00768664040940721i;2.03000000000000e-07 + 0.00000000000000i,1.80257417856255 + 0.00770442354435553i;2.04000000000000e-07 + 0.00000000000000i,1.81464991357563 + 0.00772144747709425i;2.05000000000000e-07 + 0.00000000000000i,1.82652773837395 + 0.00773813524165582i;2.06000000000000e-07 + 0.00000000000000i,1.83820908000127 + 0.00775440496144235i;2.07000000000000e-07 + 0.00000000000000i,1.84970581286914 + 0.00777036327778610i;2.08000000000000e-07 + 0.00000000000000i,1.86101207254918 + 0.00778580673101569i;2.09000000000000e-07 + 0.00000000000000i,1.87214204580194 + 0.00780094136342739i;2.10000000000000e-07 + 0.00000000000000i,1.88309343331192 + 0.00781558075916886i;2.11000000000000e-07 + 0.00000000000000i,1.89387721268661 + 0.00782999682681013i;2.12000000000000e-07 + 0.00000000000000i,1.90449104108683 + 0.00784389807971636i;2.13000000000000e-07 + 0.00000000000000i,1.91494665532052 + 0.00785765799083667i;2.14000000000000e-07 + 0.00000000000000i,1.92523932102110 + 0.00787092008415303i;2.15000000000000e-07 + 0.00000000000000i,1.93538478907531 + 0.00788408934287763i;2.16000000000000e-07 + 0.00000000000000i,1.94536913668894 + 0.00789664095076516i;2.17000000000000e-07 + 0.00000000000000i,1.95521309439954 + 0.00790909782020539i;2.18000000000000e-07 + 0.00000000000000i,1.96491430366247 + 0.00792127159361961i;2.19000000000000e-07 + 0.00000000000000i,1.97447180159694 + 0.00793304003354806i;2.20000000000000e-07 + 0.00000000000000i,1.98389178111775 + 0.00794459630024038i;2.21000000000000e-07 + 0.00000000000000i,1.99318616969905 + 0.00795599796053162i;2.22000000000000e-07 + 0.00000000000000i,2.00234308671365 + 0.00796702144049049i;2.23000000000000e-07 + 0.00000000000000i,2.01137391128492 + 0.00797787289039175i;2.24000000000000e-07 + 0.00000000000000i,2.02027668136345 + 0.00798845065791632i;2.25000000000000e-07 + 0.00000000000000i,2.02905745494213 + 0.00799872749127771i;2.26000000000000e-07 + 0.00000000000000i,2.03772078378253 + 0.00800889526760501i;2.27000000000000e-07 + 0.00000000000000i,2.04625998116566 + 0.00801856451695818i;2.28000000000000e-07 + 0.00000000000000i,2.05468870319221 + 0.00802820147098363i;2.29000000000000e-07 + 0.00000000000000i,2.06300553790693 + 0.00803765067131389i;2.30000000000000e-07 + 0.00000000000000i,2.07121179925147 + 0.00804689067077828i;2.32000000000000e-07 + 0.00000000000000i,2.08730290138406 + 0.00806474925485445i;2.34000000000000e-07 + 0.00000000000000i,2.10297858045475 + 0.00808173772465282i;2.36000000000000e-07 + 0.00000000000000i,2.11825501070191 + 0.00809804262968271i;2.38000000000000e-07 + 0.00000000000000i,2.13315081228757 + 0.00811362789829323i;2.40000000000000e-07 + 0.00000000000000i,2.14767572951948 + 0.00812852977279090i;2.42000000000000e-07 + 0.00000000000000i,2.16184571174252 + 0.00814272259612451i;2.44000000000000e-07 + 0.00000000000000i,2.17567760624109 + 0.00815655106282966i;2.46000000000000e-07 + 0.00000000000000i,2.18917714274272 + 0.00816948919468125i;2.48000000000000e-07 + 0.00000000000000i,2.20236139636980 + 0.00818209401501744i;2.50000000000000e-07 + 0.00000000000000i,2.21523673684679 + 0.00819411211985090i;2.52000000000000e-07 + 0.00000000000000i,2.22781819593077 + 0.00820565539536798i;2.54000000000000e-07 + 0.00000000000000i,2.24011106196946 + 0.00821669068130868i;2.56000000000000e-07 + 0.00000000000000i,2.25212651298174 + 0.00822720848277065i;2.58000000000000e-07 + 0.00000000000000i,2.26387597687311 + 0.00823730399775773i;2.60000000000000e-07 + 0.00000000000000i,2.27536893668705 + 0.00824706926003658i;2.62000000000000e-07 + 0.00000000000000i,2.28661147471531 + 0.00825635527089872i;2.64000000000000e-07 + 0.00000000000000i,2.29761097319932 + 0.00826526971302563i;2.66000000000000e-07 + 0.00000000000000i,2.30837593508213 + 0.00827380476433319i;2.68000000000000e-07 + 0.00000000000000i,2.31891190589630 + 0.00828196864724127i;2.70000000000000e-07 + 0.00000000000000i,2.32922891597716 + 0.00828980775996757i;2.72000000000000e-07 + 0.00000000000000i,2.33933602050325 + 0.00829737026286954i;2.74000000000000e-07 + 0.00000000000000i,2.34923326701657 + 0.00830459489044124i;2.76000000000000e-07 + 0.00000000000000i,2.35892594039999 + 0.00831141200714692i;2.78000000000000e-07 + 0.00000000000000i,2.36842684046350 + 0.00831805093892888i;2.80000000000000e-07 + 0.00000000000000i,2.37773723406940 + 0.00832435782307813i;2.82000000000000e-07 + 0.00000000000000i,2.38686307668854 + 0.00833040937048489i;2.84000000000000e-07 + 0.00000000000000i,2.39581186356329 + 0.00833627692207802i;2.86000000000000e-07 + 0.00000000000000i,2.40458594745470 + 0.00834185529594505i;2.88000000000000e-07 + 0.00000000000000i,2.41318908319066 + 0.00834716042322426i;2.90000000000000e-07 + 0.00000000000000i,2.42163084397311 + 0.00835228291492158i;2.92000000000000e-07 + 0.00000000000000i,2.42990959763139 + 0.00835713705930353i;2.94000000000000e-07 + 0.00000000000000i,2.43803394309621 + 0.00836180576187864i;2.96000000000000e-07 + 0.00000000000000i,2.44600836976202 + 0.00836626481322496i;2.98000000000000e-07 + 0.00000000000000i,2.45383377853038 + 0.00837054677844941i;3.00000000000000e-07 + 0.00000000000000i,2.46151762547795 + 0.00837466850109375i;3.02000000000000e-07 + 0.00000000000000i,2.46905930791283 + 0.00837856192426147i;3.04000000000000e-07 + 0.00000000000000i,2.47646636522257 + 0.00838232923552283i;3.06000000000000e-07 + 0.00000000000000i,2.48373991118452 + 0.00838590217545631i;3.08000000000000e-07 + 0.00000000000000i,2.49088391983270 + 0.00838933621355457i;3.10000000000000e-07 + 0.00000000000000i,2.49790198623471 + 0.00839259855814651i;3.12000000000000e-07 + 0.00000000000000i,2.50479719911129 + 0.00839569438539486i;3.14000000000000e-07 + 0.00000000000000i,2.51157160424825 + 0.00839865895365142i;3.16000000000000e-07 + 0.00000000000000i,2.51823093135635 + 0.00840150907663161i;3.18000000000000e-07 + 0.00000000000000i,2.52477408701214 + 0.00840417518415552i;3.20000000000000e-07 + 0.00000000000000i,2.53120841102460 + 0.00840676930358695i;3.22000000000000e-07 + 0.00000000000000i,2.53753100485713 + 0.00840918638278474i;3.24000000000000e-07 + 0.00000000000000i,2.54374960215326 + 0.00841154321694450i;3.26000000000000e-07 + 0.00000000000000i,2.54986289666044 + 0.00841373287510730i;3.28000000000000e-07 + 0.00000000000000i,2.55587545243922 + 0.00841582741505120i;3.30000000000000e-07 + 0.00000000000000i,2.56178778649196 + 0.00841781308387136i;3.32000000000000e-07 + 0.00000000000000i,2.56760508096061 + 0.00841970683888565i;3.34000000000000e-07 + 0.00000000000000i,2.57332806921958 + 0.00842150992953296i;3.36000000000000e-07 + 0.00000000000000i,2.57895779004307 + 0.00842318552713688i;3.38000000000000e-07 + 0.00000000000000i,2.58449785875658 + 0.00842479939121885i;3.40000000000000e-07 + 0.00000000000000i,2.58994997462160 + 0.00842631836952285i;3.42000000000000e-07 + 0.00000000000000i,2.59531512359722 + 0.00842774323245556i;3.44000000000000e-07 + 0.00000000000000i,2.60059642275303 + 0.00842908778216589i;3.46000000000000e-07 + 0.00000000000000i,2.60579597406871 + 0.00843036980479107i;3.48000000000000e-07 + 0.00000000000000i,2.61091308780569 + 0.00843152882332889i;3.50000000000000e-07 + 0.00000000000000i,2.61595189885134 + 0.00843264827134526i;3.52000000000000e-07 + 0.00000000000000i,2.62091261174522 + 0.00843366171128096i;3.54000000000000e-07 + 0.00000000000000i,2.62579926870117 + 0.00843466114749833i;3.56000000000000e-07 + 0.00000000000000i,2.63061037022315 + 0.00843556268524657i;3.58000000000000e-07 + 0.00000000000000i,2.63534920816184 + 0.00843638796056773i;3.60000000000000e-07 + 0.00000000000000i,2.64001792325851 + 0.00843716801530227i;3.62000000000000e-07 + 0.00000000000000i,2.64461643790700 + 0.00843788248355851i;3.64000000000000e-07 + 0.00000000000000i,2.64914618935132 + 0.00843850801223517i;3.66000000000000e-07 + 0.00000000000000i,2.65361055060327 + 0.00843913123630164i;3.68000000000000e-07 + 0.00000000000000i,2.65800942207759 + 0.00843968459712577i;3.70000000000000e-07 + 0.00000000000000i,2.66234300826754 + 0.00844014758605119i;3.72000000000000e-07 + 0.00000000000000i,2.66661536990551 + 0.00844060521428432i;3.74000000000000e-07 + 0.00000000000000i,2.67082541697972 + 0.00844099342107530i;3.76000000000000e-07 + 0.00000000000000i,2.67497506482510 + 0.00844133467660536i;3.78000000000000e-07 + 0.00000000000000i,2.67906572118215 + 0.00844163165266245i;3.80000000000000e-07 + 0.00000000000000i,2.68309842863815 + 0.00844187931553195i;3.82000000000000e-07 + 0.00000000000000i,2.68707445781770 + 0.00844209186258381i;3.84000000000000e-07 + 0.00000000000000i,2.69099463631383 + 0.00844226574382002i;3.86000000000000e-07 + 0.00000000000000i,2.69486056813364 + 0.00844240514723375i;3.88000000000000e-07 + 0.00000000000000i,2.69867257735184 + 0.00844249243789742i;3.90000000000000e-07 + 0.00000000000000i,2.70243183377355 + 0.00844253906815482i;3.92000000000000e-07 + 0.00000000000000i,2.70614023743958 + 0.00844257586372665i;3.94000000000000e-07 + 0.00000000000000i,2.70979740025800 + 0.00844255200980415i;3.96000000000000e-07 + 0.00000000000000i,2.71340496803272 + 0.00844248702028358i;3.98000000000000e-07 + 0.00000000000000i,2.71696492013770 + 0.00844243522290037i;4.00000000000000e-07 + 0.00000000000000i,2.72047513634662 + 0.00844229685651596i];
d = Data(:,1);neff = (Data(:,2));perm = neff.^2;

figure;
yyaxis right;
plot(d*1e9,abs(real(perm)));
set(gcf, 'Position', [00, 00, 400, 300]);
ylabel('Real permittivity');
xlabel('Waveguide width');
yyaxis left;
hold on;
plot(d*1e9,imag(perm));
ylabel('Imaginary permittivity');
xlabel('Waveguide width');
legend(["Imaginary permittivity","Real permittivity"]);
title('200nm InP Left');
xlim([130 500]);

k0 = 2*pi/1550e-5;
L = 20e-6;
M = 300;
ne = 2.6;
z = -L/2:(L/(M - 1)):L/2;
wz = 2*ne*z/L;
permz = wz.^2;
figure;
plot(z,permz);

for ind = 1:1:M
    [~,inx] = min(abs((real(permz(ind) - perm)))); 
    d_Al(ind) = d(inx); 
    eps(ind) = perm(inx); 
end

figure;
yyaxis left;
plot(z*1e6,real(eps));
set(gcf, 'Position', [00, 00, 400, 300]);
xlabel('x(\mum)');
ylabel('Re[\epsilon]');
yyaxis right
plot(z*1e6,imag(eps));
set(gcf, 'Position', [00, 00, 400, 300]);
xlabel('x(\mum)');
ylabel('Im[\epsilon]');

figure;
plot(z*1e6,d_Al*1e9);
set(gcf, 'Position', [00, 00, 400, 300]);
xlabel('x(\mum)');
ylabel('Waveguide width(nm)')

figure;
plot(z,imag(eps))

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%For Comsol Geometry
% a = 0.181/0.161 - 1;
a = 0.161/0.161 - 1;
gc = -a*(abs(2*z/L)).^2 + a + 1;
Al_Y = [d_Al.*gc*1e6 -d_Al.*gc*1e6]/2;
Al_Y_h = Al_Y';
Al_Z = [z -z]*1e6;
Al_Z_h = Al_Z';
% Al_Y = [d_Al-0.0e-6 -d_Al+0.0e-6]/2*1e6;Al_Z = [z -z]*1e6;
% PumpSweep = unique(Lx_Al_Com)*1e9;
SiO_Y = [d_Al + 60e-9 -d_Al - 60e-9]/2*1e6;
SiO_Z = [z -z];


% % %%%%3.3^2 +(0.03*exp(-((z-5.168[um])/2[um])^2) + 0.03*exp(-((z+5.168[um])/2[um])^2) + 0.017*exp(-(z/10[um])^2))*i
% % tm = 0.03*exp(-((z-5.168e-6)/2e-6).^2) + 0.03*exp(-((z+5.168e-6)/2e-6).^2) + 0.017*exp(-(z/10e-6).^2);
% % figure
% % plot(z,tm)