clc
clear all
close all

Data = [1.55000000000000e-07 + 0.00000000000000i,0.0433385015886507 + 0.0732598410046034i;1.56000000000000e-07 + 0.00000000000000i,0.269403517861212 + 0.0132506216297901i;1.57000000000000e-07 + 0.00000000000000i,0.383913915201499 + 0.0102930241042072i;1.58000000000000e-07 + 0.00000000000000i,0.470403355900904 + 0.00918513754006275i;1.59000000000000e-07 + 0.00000000000000i,0.542404908294336 + 0.00862355312714518i;1.60000000000000e-07 + 0.00000000000000i,0.605137815105406 + 0.00829948012296756i;1.61000000000000e-07 + 0.00000000000000i,0.661235353073100 + 0.00809912825881370i;1.62000000000000e-07 + 0.00000000000000i,0.712292789829607 + 0.00797032348977676i;1.63000000000000e-07 + 0.00000000000000i,0.759327864175499 + 0.00788519469797055i;1.64000000000000e-07 + 0.00000000000000i,0.803052611866842 + 0.00782760537704070i;1.65000000000000e-07 + 0.00000000000000i,0.843969332771905 + 0.00778738192010279i;1.66000000000000e-07 + 0.00000000000000i,0.882494135901960 + 0.00775759440375080i;1.67000000000000e-07 + 0.00000000000000i,0.918900498995953 + 0.00773155773345725i;1.68000000000000e-07 + 0.00000000000000i,0.953407267133247 + 0.00770530353575131i;1.69000000000000e-07 + 0.00000000000000i,0.986255650239960 + 0.00767438738428729i;1.70000000000000e-07 + 0.00000000000000i,1.01756838879081 + 0.00763462148838071i;1.71000000000000e-07 + 0.00000000000000i,1.04747245606807 + 0.00758057696583608i;1.72000000000000e-07 + 0.00000000000000i,1.07602927189443 + 0.00750516574203617i;1.73000000000000e-07 + 0.00000000000000i,1.10333002886077 + 0.00739968722188217i;1.74000000000000e-07 + 0.00000000000000i,1.12940101282170 + 0.00725330278804893i;1.75000000000000e-07 + 0.00000000000000i,1.15425708333130 + 0.00705418366245103i;1.76000000000000e-07 + 0.00000000000000i,1.17789988529875 + 0.00679190185363772i;1.77000000000000e-07 + 0.00000000000000i,1.20031010060817 + 0.00646562844400382i;1.78000000000000e-07 + 0.00000000000000i,1.25905361958432 + 0.00609303442411301i;1.79000000000000e-07 + 0.00000000000000i,1.27860340182819 + 0.00644214005833752i;1.80000000000000e-07 + 0.00000000000000i,1.29819758498234 + 0.00677900751961405i;1.81000000000000e-07 + 0.00000000000000i,1.31777907757600 + 0.00707857668004676i;1.82000000000000e-07 + 0.00000000000000i,1.33725098773912 + 0.00732979253465768i;1.83000000000000e-07 + 0.00000000000000i,1.35652986516509 + 0.00753373786378282i;1.84000000000000e-07 + 0.00000000000000i,1.37555482509102 + 0.00769762279887414i;1.85000000000000e-07 + 0.00000000000000i,1.39428587633021 + 0.00782987422712728i;1.86000000000000e-07 + 0.00000000000000i,1.41269743987571 + 0.00793763408210606i;1.87000000000000e-07 + 0.00000000000000i,1.43077800366383 + 0.00802690278826085i;1.88000000000000e-07 + 0.00000000000000i,1.44850899417292 + 0.00810190713865512i;1.89000000000000e-07 + 0.00000000000000i,1.46589891181088 + 0.00816609810222471i;1.90000000000000e-07 + 0.00000000000000i,1.48294498030755 + 0.00822169157407321i;1.91000000000000e-07 + 0.00000000000000i,1.49963999418775 + 0.00827054198918129i;1.92000000000000e-07 + 0.00000000000000i,1.51601976691102 + 0.00831434095107900i;1.93000000000000e-07 + 0.00000000000000i,1.53207378291099 + 0.00835386270927110i;1.94000000000000e-07 + 0.00000000000000i,1.54781302992624 + 0.00838983090284287i;1.95000000000000e-07 + 0.00000000000000i,1.56325070261788 + 0.00842293232304053i;1.96000000000000e-07 + 0.00000000000000i,1.57838385942393 + 0.00845347714654825i;1.97000000000000e-07 + 0.00000000000000i,1.59323221394748 + 0.00848203211811872i;1.98000000000000e-07 + 0.00000000000000i,1.60779979497115 + 0.00850879366267517i;1.99000000000000e-07 + 0.00000000000000i,1.62209363738326 + 0.00853384772886320i;2.00000000000000e-07 + 0.00000000000000i,1.63612669508101 + 0.00855764855580510i;2.01000000000000e-07 + 0.00000000000000i,1.64990411189222 + 0.00858017987397212i;2.02000000000000e-07 + 0.00000000000000i,1.66342679289358 + 0.00860160593266644i;2.03000000000000e-07 + 0.00000000000000i,1.67671227480282 + 0.00862201870458140i;2.04000000000000e-07 + 0.00000000000000i,1.68976384497370 + 0.00864163367491973i;2.05000000000000e-07 + 0.00000000000000i,1.70258694752757 + 0.00866037371475027i;2.06000000000000e-07 + 0.00000000000000i,1.71518869561474 + 0.00867835040378054i;2.07000000000000e-07 + 0.00000000000000i,1.72757555800793 + 0.00869561191063224i;2.08000000000000e-07 + 0.00000000000000i,1.73975492290112 + 0.00871228237674086i;2.09000000000000e-07 + 0.00000000000000i,1.75172935475689 + 0.00872834346165070i;2.10000000000000e-07 + 0.00000000000000i,1.76350771494592 + 0.00874385006252492i;2.11000000000000e-07 + 0.00000000000000i,1.77508996587972 + 0.00875877208263909i;2.12000000000000e-07 + 0.00000000000000i,1.78649025074572 + 0.00877325709386034i;2.13000000000000e-07 + 0.00000000000000i,1.79770172400751 + 0.00878727493437721i;2.14000000000000e-07 + 0.00000000000000i,1.80873981892238 + 0.00880076021397553i;2.15000000000000e-07 + 0.00000000000000i,1.81960624525447 + 0.00881389400812978i;2.16000000000000e-07 + 0.00000000000000i,1.83030332085708 + 0.00882657022792810i;2.17000000000000e-07 + 0.00000000000000i,1.84083546471190 + 0.00883898570577302i;2.18000000000000e-07 + 0.00000000000000i,1.85120736410381 + 0.00885097655407159i;2.19000000000000e-07 + 0.00000000000000i,1.86142355088174 + 0.00886256495131298i;2.20000000000000e-07 + 0.00000000000000i,1.87148495016296 + 0.00887383423773529i;2.21000000000000e-07 + 0.00000000000000i,1.88139871445715 + 0.00888482173727398i;2.22000000000000e-07 + 0.00000000000000i,1.89116759896843 + 0.00889542954656697i;2.23000000000000e-07 + 0.00000000000000i,1.90079220802951 + 0.00890573022737805i;2.24000000000000e-07 + 0.00000000000000i,1.91028364421988 + 0.00891576338329993i;2.25000000000000e-07 + 0.00000000000000i,1.91963068745633 + 0.00892551605671003i;2.26000000000000e-07 + 0.00000000000000i,1.92885178245672 + 0.00893506935705499i;2.27000000000000e-07 + 0.00000000000000i,1.93794045210310 + 0.00894434773894009i;2.28000000000000e-07 + 0.00000000000000i,1.94690609155962 + 0.00895338062414381i;2.29000000000000e-07 + 0.00000000000000i,1.95574205370035 + 0.00896214847482261i;2.30000000000000e-07 + 0.00000000000000i,1.96445924009247 + 0.00897071392839770i;2.32000000000000e-07 + 0.00000000000000i,1.98153770025360 + 0.00898703974583943i;2.34000000000000e-07 + 0.00000000000000i,1.99816233601589 + 0.00900269411521744i;2.36000000000000e-07 + 0.00000000000000i,2.01435199833882 + 0.00901749940282872i;2.38000000000000e-07 + 0.00000000000000i,2.03012297584325 + 0.00903153833149620i;2.40000000000000e-07 + 0.00000000000000i,2.04549132206949 + 0.00904488351051508i;2.42000000000000e-07 + 0.00000000000000i,2.06047271567577 + 0.00905752265174363i;2.44000000000000e-07 + 0.00000000000000i,2.07507958816097 + 0.00906955432159178i;2.46000000000000e-07 + 0.00000000000000i,2.08933278215705 + 0.00908096001889089i;2.48000000000000e-07 + 0.00000000000000i,2.10324073654970 + 0.00909181808087323i;2.50000000000000e-07 + 0.00000000000000i,2.11681614308473 + 0.00910215052547294i;2.52000000000000e-07 + 0.00000000000000i,2.13007101727788 + 0.00911198960502721i;2.54000000000000e-07 + 0.00000000000000i,2.14301768553972 + 0.00912131650584066i;2.56000000000000e-07 + 0.00000000000000i,2.15566604449982 + 0.00913020610919141i;2.58000000000000e-07 + 0.00000000000000i,2.16802510302894 + 0.00913864427685382i;2.60000000000000e-07 + 0.00000000000000i,2.18010693547535 + 0.00914669957941845i;2.62000000000000e-07 + 0.00000000000000i,2.19191848868793 + 0.00915434827340955i;2.64000000000000e-07 + 0.00000000000000i,2.20347030745774 + 0.00916156584660567i;2.66000000000000e-07 + 0.00000000000000i,2.21476838670319 + 0.00916849096757621i;2.68000000000000e-07 + 0.00000000000000i,2.22582409578364 + 0.00917506897664968i;2.70000000000000e-07 + 0.00000000000000i,2.23664518289934 + 0.00918132374416465i;2.72000000000000e-07 + 0.00000000000000i,2.24723764160751 + 0.00918723635988576i;2.74000000000000e-07 + 0.00000000000000i,2.25760886771280 + 0.00919283659789765i;2.76000000000000e-07 + 0.00000000000000i,2.26776501413959 + 0.00919817578123611i;2.78000000000000e-07 + 0.00000000000000i,2.27771233737362 + 0.00920320921267425i;2.80000000000000e-07 + 0.00000000000000i,2.28745756610346 + 0.00920801019065730i;2.82000000000000e-07 + 0.00000000000000i,2.29700642605552 + 0.00921255811545406i;2.84000000000000e-07 + 0.00000000000000i,2.30636427273837 + 0.00921686652391715i;2.86000000000000e-07 + 0.00000000000000i,2.31553821972012 + 0.00922095195678100i;2.88000000000000e-07 + 0.00000000000000i,2.32453074753691 + 0.00922485047638523i;2.90000000000000e-07 + 0.00000000000000i,2.33334936422386 + 0.00922847895182369i;2.92000000000000e-07 + 0.00000000000000i,2.34199919347484 + 0.00923192878303767i;2.94000000000000e-07 + 0.00000000000000i,2.35048241648268 + 0.00923517082751681i;2.96000000000000e-07 + 0.00000000000000i,2.35880613971474 + 0.00923827269157329i;2.98000000000000e-07 + 0.00000000000000i,2.36697351908061 + 0.00924114598611775i;3.00000000000000e-07 + 0.00000000000000i,2.37498863395019 + 0.00924388794434898i;3.02000000000000e-07 + 0.00000000000000i,2.38285505593007 + 0.00924645430726017i;3.04000000000000e-07 + 0.00000000000000i,2.39057796684039 + 0.00924884937933591i;3.06000000000000e-07 + 0.00000000000000i,2.39816096116273 + 0.00925107671410197i;3.08000000000000e-07 + 0.00000000000000i,2.40560719839152 + 0.00925321222707694i;3.10000000000000e-07 + 0.00000000000000i,2.41291900213798 + 0.00925518320460117i;3.12000000000000e-07 + 0.00000000000000i,2.42010098815014 + 0.00925700659342895i;3.14000000000000e-07 + 0.00000000000000i,2.42715707154060 + 0.00925874136835150i;3.16000000000000e-07 + 0.00000000000000i,2.43408874357324 + 0.00926034191912936i;3.18000000000000e-07 + 0.00000000000000i,2.44090104270060 + 0.00926181435416917i;3.20000000000000e-07 + 0.00000000000000i,2.44759569237165 + 0.00926316800482603i;3.22000000000000e-07 + 0.00000000000000i,2.45417575855799 + 0.00926443789846415i;3.24000000000000e-07 + 0.00000000000000i,2.46064424702083 + 0.00926556814550035i;3.26000000000000e-07 + 0.00000000000000i,2.46700306769013 + 0.00926662629791955i;3.28000000000000e-07 + 0.00000000000000i,2.47325513424379 + 0.00926756359018820i;3.30000000000000e-07 + 0.00000000000000i,2.47940366518663 + 0.00926841681223405i;3.32000000000000e-07 + 0.00000000000000i,2.48545042502885 + 0.00926920004056752i;3.34000000000000e-07 + 0.00000000000000i,2.49139772632081 + 0.00926988941972953i;3.36000000000000e-07 + 0.00000000000000i,2.49724734630962 + 0.00927050191648256i;3.38000000000000e-07 + 0.00000000000000i,2.50300205627167 + 0.00927103412846746i;3.40000000000000e-07 + 0.00000000000000i,2.50866487315260 + 0.00927149050177601i;3.42000000000000e-07 + 0.00000000000000i,2.51423700578005 + 0.00927186392562261i;3.44000000000000e-07 + 0.00000000000000i,2.51972082129356 + 0.00927217734112806i;3.46000000000000e-07 + 0.00000000000000i,2.52511806131057 + 0.00927239163570641i;3.48000000000000e-07 + 0.00000000000000i,2.53043121087061 + 0.00927257014783720i;3.50000000000000e-07 + 0.00000000000000i,2.53566100098851 + 0.00927268343621571i;3.52000000000000e-07 + 0.00000000000000i,2.54080924380880 + 0.00927273011953831i;3.54000000000000e-07 + 0.00000000000000i,2.54587861467852 + 0.00927273100340550i;3.56000000000000e-07 + 0.00000000000000i,2.55087028682739 + 0.00927267739993613i;3.58000000000000e-07 + 0.00000000000000i,2.55578624779757 + 0.00927256785875662i;3.60000000000000e-07 + 0.00000000000000i,2.56062719305270 + 0.00927241518457814i;3.62000000000000e-07 + 0.00000000000000i,2.56539648400359 + 0.00927219333998157i;3.64000000000000e-07 + 0.00000000000000i,2.57009287409654 + 0.00927195389700890i;3.66000000000000e-07 + 0.00000000000000i,2.57472075210209 + 0.00927164180475259i;3.68000000000000e-07 + 0.00000000000000i,2.57927992015088 + 0.00927129171564710i;3.70000000000000e-07 + 0.00000000000000i,2.58377162747782 + 0.00927088436765197i;3.72000000000000e-07 + 0.00000000000000i,2.58819832944825 + 0.00927046079660943i;3.74000000000000e-07 + 0.00000000000000i,2.59256045374682 + 0.00927001277123903i;3.76000000000000e-07 + 0.00000000000000i,2.59685991316286 + 0.00926950332992178i;3.78000000000000e-07 + 0.00000000000000i,2.60109793608511 + 0.00926896932251827i;3.80000000000000e-07 + 0.00000000000000i,2.60527535320016 + 0.00926839805486965i;3.82000000000000e-07 + 0.00000000000000i,2.60939300746472 + 0.00926779597666943i;3.84000000000000e-07 + 0.00000000000000i,2.61345235275749 + 0.00926714497174791i;3.86000000000000e-07 + 0.00000000000000i,2.61745542536146 + 0.00926647301863314i;3.88000000000000e-07 + 0.00000000000000i,2.62140168075958 + 0.00926577728097181i;3.90000000000000e-07 + 0.00000000000000i,2.62529350775850 + 0.00926505855726000i;3.92000000000000e-07 + 0.00000000000000i,2.62913130276615 + 0.00926431237325320i;3.94000000000000e-07 + 0.00000000000000i,2.63291691936593 + 0.00926353353823130i;3.96000000000000e-07 + 0.00000000000000i,2.63665043993117 + 0.00926272956660681i;3.98000000000000e-07 + 0.00000000000000i,2.64033313303110 + 0.00926190325568087i;4.00000000000000e-07 + 0.00000000000000i,2.64396573898974 + 0.00926105877672924i];
d = Data(:,1);neff = (Data(:,2));perm = neff.^2;

figure;
yyaxis right;
plot(d*1e9,abs(real(perm)));
set(gcf, 'Position', [00, 00, 400, 300]);
ylabel('Real permittivity');
xlabel('Waveguide width');
yyaxis left;
hold on;
plot(d*1e9,imag(perm));
ylabel('Imaginary permittivity');
xlabel('Waveguide width');
legend(["Imaginary permittivity","Real permittivity"]);
title('50nm InP Left');
xlim([130 500]);

k0 = 2*pi/1550e-5;
L = 20e-6;
M = 300;
ne = 2.6;
z = -L/2:(L/(M - 1)):L/2;
wz = 2*ne*z/L;
permz = wz.^2;
figure;
plot(z,permz);

for ind = 1:1:M
    [~,inx] = min(abs((real(permz(ind) - perm)))); 
    d_Al(ind) = d(inx); 
    eps(ind) = perm(inx); 
end

figure;
yyaxis left;
plot(z*1e6,real(eps));
set(gcf, 'Position', [00, 00, 400, 300]);
xlabel('x(\mum)');
ylabel('Re[\epsilon]');
yyaxis right
plot(z*1e6,imag(eps));
set(gcf, 'Position', [00, 00, 400, 300]);
xlabel('x(\mum)');
ylabel('Im[\epsilon]');

figure;
plot(z*1e6,d_Al*1e9);
set(gcf, 'Position', [00, 00, 400, 300]);
xlabel('x(\mum)');
ylabel('Waveguide width(nm)')

figure;
plot(z,imag(eps))

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%For Comsol Geometry
% a = 0.181/0.161 - 1;
a = 0.161/0.161 - 1;
gc = -a*(abs(2*z/L)).^2 + a + 1;
Al_Y = [d_Al.*gc*1e6 -d_Al.*gc*1e6]/2;
Al_Y_h = Al_Y';
Al_Z = [z -z]*1e6;
Al_Z_h = Al_Z';
% Al_Y = [d_Al-0.0e-6 -d_Al+0.0e-6]/2*1e6;Al_Z = [z -z]*1e6;
% PumpSweep = unique(Lx_Al_Com)*1e9;
SiO_Y = [d_Al + 60e-9 -d_Al - 60e-9]/2*1e6;
SiO_Z = [z -z];


% % %%%%3.3^2 +(0.03*exp(-((z-5.168[um])/2[um])^2) + 0.03*exp(-((z+5.168[um])/2[um])^2) + 0.017*exp(-(z/10[um])^2))*i
% % tm = 0.03*exp(-((z-5.168e-6)/2e-6).^2) + 0.03*exp(-((z+5.168e-6)/2e-6).^2) + 0.017*exp(-(z/10e-6).^2);
% % figure
% % plot(z,tm)