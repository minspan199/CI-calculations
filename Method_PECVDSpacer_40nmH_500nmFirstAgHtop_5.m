clc
clear all
close all

Data = [1.33000000000000e-07 + 0.00000000000000i,0.0458350192967257 + 0.141285371939161i;1.33500000000000e-07 + 0.00000000000000i,0.110968643743071 + 0.0581262188864347i;1.34000000000000e-07 + 0.00000000000000i,0.191395500024987 + 0.0335559837602481i;1.34500000000000e-07 + 0.00000000000000i,0.250179979000262 + 0.0255582726410877i;1.35000000000000e-07 + 0.00000000000000i,0.297736748264432 + 0.0213777423583805i;1.35500000000000e-07 + 0.00000000000000i,0.338532088832018 + 0.0187118735565341i;1.36000000000000e-07 + 0.00000000000000i,0.374741817669759 + 0.0168210776216753i;1.36500000000000e-07 + 0.00000000000000i,0.407585900989310 + 0.0153885422303026i;1.37000000000000e-07 + 0.00000000000000i,0.437817737465801 + 0.0142536187374381i;1.37500000000000e-07 + 0.00000000000000i,0.465909316515765 + 0.0133247174731927i;1.38000000000000e-07 + 0.00000000000000i,0.492266529155756 + 0.0125453933040710i;1.38500000000000e-07 + 0.00000000000000i,0.517087272485281 + 0.0118783153298596i;1.39000000000000e-07 + 0.00000000000000i,0.540661044488167 + 0.0112986929316145i;1.39500000000000e-07 + 0.00000000000000i,0.563111876693218 + 0.0107881701051446i;1.40000000000000e-07 + 0.00000000000000i,0.584559899866427 + 0.0103335044487711i;1.40500000000000e-07 + 0.00000000000000i,0.605130984397728 + 0.00992481009301978i;1.41000000000000e-07 + 0.00000000000000i,0.624907576122452 + 0.00955446861571172i;1.41500000000000e-07 + 0.00000000000000i,0.643942652743694 + 0.00921590563471133i;1.42000000000000e-07 + 0.00000000000000i,0.662333934413809 + 0.00890486063841938i;1.42500000000000e-07 + 0.00000000000000i,0.680132721206233 + 0.00861756142094864i;1.43000000000000e-07 + 0.00000000000000i,0.697355933673291 + 0.00834994799217997i;1.43500000000000e-07 + 0.00000000000000i,0.714060122702667 + 0.00809961256690595i;1.44000000000000e-07 + 0.00000000000000i,0.730288163783080 + 0.00786443030262816i;1.44500000000000e-07 + 0.00000000000000i,0.746083993550717 + 0.00764266338026077i;1.45000000000000e-07 + 0.00000000000000i,0.761457304307441 + 0.00743215183651472i;1.45500000000000e-07 + 0.00000000000000i,0.776432062073794 + 0.00723126017798476i;1.46000000000000e-07 + 0.00000000000000i,0.791043178545878 + 0.00703892120693914i;1.46500000000000e-07 + 0.00000000000000i,0.805299964289868 + 0.00685362463790786i;1.47000000000000e-07 + 0.00000000000000i,0.819232106538821 + 0.00667451253440271i;1.47500000000000e-07 + 0.00000000000000i,0.832857625677522 + 0.00650060906881284i;1.48000000000000e-07 + 0.00000000000000i,0.846183072419390 + 0.00633085039453619i;1.48500000000000e-07 + 0.00000000000000i,0.859238408912454 + 0.00616494920602706i;1.49000000000000e-07 + 0.00000000000000i,0.872024626403902 + 0.00600203833427664i;1.49500000000000e-07 + 0.00000000000000i,0.884556839775630 + 0.00584209789124615i;1.50000000000000e-07 + 0.00000000000000i,0.896852715185320 + 0.00568534916806179i;1.50500000000000e-07 + 0.00000000000000i,0.908934770868575 + 0.00553282706800897i;1.51000000000000e-07 + 0.00000000000000i,0.920795387357763 + 0.00538529392840286i;1.51500000000000e-07 + 0.00000000000000i,0.932444327989643 + 0.00524446607857315i;1.52000000000000e-07 + 0.00000000000000i,0.943904648367690 + 0.00511321621349307i;1.52500000000000e-07 + 0.00000000000000i,0.955178976728164 + 0.00499388008825152i;1.53000000000000e-07 + 0.00000000000000i,0.966266588550564 + 0.00488873710291333i;1.53500000000000e-07 + 0.00000000000000i,0.977161518932792 + 0.00479917500493462i;1.54000000000000e-07 + 0.00000000000000i,0.987894778132132 + 0.00472646862639502i;1.54500000000000e-07 + 0.00000000000000i,0.998453927673638 + 0.00466935456590067i;1.55000000000000e-07 + 0.00000000000000i,1.00883924499868 + 0.00462601239048357i;1.55500000000000e-07 + 0.00000000000000i,1.01906258191090 + 0.00459364854249233i;1.56000000000000e-07 + 0.00000000000000i,1.02912440733117 + 0.00456941702281547i;1.56500000000000e-07 + 0.00000000000000i,1.03901709721287 + 0.00455004625555075i;1.57000000000000e-07 + 0.00000000000000i,1.04876942712403 + 0.00453394766472398i;1.57500000000000e-07 + 0.00000000000000i,1.05837457511931 + 0.00451909503487380i;1.58000000000000e-07 + 0.00000000000000i,1.06784491393284 + 0.00450455960126579i;1.58500000000000e-07 + 0.00000000000000i,1.07716968582741 + 0.00448911986197512i;1.59000000000000e-07 + 0.00000000000000i,1.08637445456164 + 0.00447308761266617i;1.59500000000000e-07 + 0.00000000000000i,1.09545440082984 + 0.00445607708272253i;1.60000000000000e-07 + 0.00000000000000i,1.10441212350588 + 0.00443813428148416i;1.60500000000000e-07 + 0.00000000000000i,1.11325796790712 + 0.00441965043437613i;1.61000000000000e-07 + 0.00000000000000i,1.12199274611609 + 0.00440077557002554i;1.61500000000000e-07 + 0.00000000000000i,1.13062036112743 + 0.00438179898975996i;1.62000000000000e-07 + 0.00000000000000i,1.13913801684754 + 0.00436280117574567i;1.62500000000000e-07 + 0.00000000000000i,1.14756601456204 + 0.00434462686569301i;1.63000000000000e-07 + 0.00000000000000i,1.15590121432983 + 0.00432740003055451i;1.63500000000000e-07 + 0.00000000000000i,1.16413623453266 + 0.00431112471744707i;1.64000000000000e-07 + 0.00000000000000i,1.17228054463400 + 0.00429626928480723i;1.64500000000000e-07 + 0.00000000000000i,1.18035057657557 + 0.00428355576946829i;1.65000000000000e-07 + 0.00000000000000i,1.18832420028449 + 0.00427274609006193i;1.65500000000000e-07 + 0.00000000000000i,1.19623237679890 + 0.00426493846084610i;1.66000000000000e-07 + 0.00000000000000i,1.20405736135265 + 0.00425992749401293i;1.66500000000000e-07 + 0.00000000000000i,1.21182203710687 + 0.00425883628082245i;1.67000000000000e-07 + 0.00000000000000i,1.21951460722417 + 0.00426174163364820i;1.67500000000000e-07 + 0.00000000000000i,1.22714160548156 + 0.00426938753595053i;1.68000000000000e-07 + 0.00000000000000i,1.23470672160667 + 0.00428237632673494i;1.68500000000000e-07 + 0.00000000000000i,1.24222496888284 + 0.00430192451052443i;1.69000000000000e-07 + 0.00000000000000i,1.24969630725285 + 0.00432890874863166i;1.69500000000000e-07 + 0.00000000000000i,1.25711688746442 + 0.00436409711074761i;1.70000000000000e-07 + 0.00000000000000i,1.26450031872307 + 0.00440897125359675i;1.70500000000000e-07 + 0.00000000000000i,1.27185927068642 + 0.00446535580952088i;1.71000000000000e-07 + 0.00000000000000i,1.27919566872102 + 0.00453460259173995i;1.71500000000000e-07 + 0.00000000000000i,1.28651021508635 + 0.00461821607120157i;1.72000000000000e-07 + 0.00000000000000i,1.29382000716748 + 0.00471841921754571i;1.72500000000000e-07 + 0.00000000000000i,1.30113175303346 + 0.00483716423061583i;1.73000000000000e-07 + 0.00000000000000i,1.30845216731917 + 0.00497599325016667i;1.73500000000000e-07 + 0.00000000000000i,1.31580452030957 + 0.00513667168921589i;1.74000000000000e-07 + 0.00000000000000i,1.32319535194446 + 0.00532012141476568i;1.74500000000000e-07 + 0.00000000000000i,1.33062813662666 + 0.00552576043085403i;1.75000000000000e-07 + 0.00000000000000i,1.33811670860384 + 0.00575239858762994i;1.75500000000000e-07 + 0.00000000000000i,1.34567438162581 + 0.00599683550530832i;1.76000000000000e-07 + 0.00000000000000i,1.35330212167073 + 0.00625448292954397i;2.16500000000000e-07 + 0.00000000000000i,1.86870296861055 + 0.00985939989750098i;2.16500000000000e-07 + 0.00000000000000i,1.86870296861055 + 0.00985939989750098i;2.17000000000000e-07 + 0.00000000000000i,1.87327070368666 + 0.00986220452725299i;2.17000000000000e-07 + 0.00000000000000i,1.87327070368666 + 0.00986220452725299i;2.17500000000000e-07 + 0.00000000000000i,1.87780910311681 + 0.00986513850468252i;2.17500000000000e-07 + 0.00000000000000i,1.87780910311681 + 0.00986513850468252i;2.18000000000000e-07 + 0.00000000000000i,1.88231764133505 + 0.00986799579502534i;2.18000000000000e-07 + 0.00000000000000i,1.88231764133505 + 0.00986799579502534i;2.18500000000000e-07 + 0.00000000000000i,1.88679300903596 + 0.00987081383383769i;2.18500000000000e-07 + 0.00000000000000i,1.88679300903596 + 0.00987081383383769i;2.19000000000000e-07 + 0.00000000000000i,1.89123496020707 + 0.00987350067864046i;2.19000000000000e-07 + 0.00000000000000i,1.89123496020707 + 0.00987350067864046i;2.19500000000000e-07 + 0.00000000000000i,1.89564591544446 + 0.00987611687424257i;2.19500000000000e-07 + 0.00000000000000i,1.89564591544446 + 0.00987611687424257i;2.20000000000000e-07 + 0.00000000000000i,1.90002735753313 + 0.00987868585070852i;2.20000000000000e-07 + 0.00000000000000i,1.90002735753313 + 0.00987868585070852i;2.20500000000000e-07 + 0.00000000000000i,1.90438043538291 + 0.00988128509076956i;2.20500000000000e-07 + 0.00000000000000i,1.90438043538291 + 0.00988128509076956i;2.21000000000000e-07 + 0.00000000000000i,1.90870183064098 + 0.00988375689949858i;2.21000000000000e-07 + 0.00000000000000i,1.90870183064098 + 0.00988375689949858i;2.21500000000000e-07 + 0.00000000000000i,1.91299349925568 + 0.00988614504402640i;2.21500000000000e-07 + 0.00000000000000i,1.91299349925568 + 0.00988614504402640i;2.22000000000000e-07 + 0.00000000000000i,1.91725790974999 + 0.00988858041830810i;2.22000000000000e-07 + 0.00000000000000i,1.91725790974999 + 0.00988858041830810i;2.22500000000000e-07 + 0.00000000000000i,1.92149075424228 + 0.00989087333619617i;2.22500000000000e-07 + 0.00000000000000i,1.92149075424228 + 0.00989087333619617i;2.23000000000000e-07 + 0.00000000000000i,1.92569295422018 + 0.00989310081108840i;2.23000000000000e-07 + 0.00000000000000i,1.92569295422018 + 0.00989310081108840i;2.23500000000000e-07 + 0.00000000000000i,1.92987125063946 + 0.00989535320129316i;2.23500000000000e-07 + 0.00000000000000i,1.92987125063946 + 0.00989535320129316i;2.24000000000000e-07 + 0.00000000000000i,1.93401936872552 + 0.00989751072786059i;2.24000000000000e-07 + 0.00000000000000i,1.93401936872552 + 0.00989751072786059i;2.24500000000000e-07 + 0.00000000000000i,1.93814304846119 + 0.00989968414849013i;2.24500000000000e-07 + 0.00000000000000i,1.93814304846119 + 0.00989968414849013i;2.25000000000000e-07 + 0.00000000000000i,1.94223452924205 + 0.00990172439930831i;2.25000000000000e-07 + 0.00000000000000i,1.94223452924205 + 0.00990172439930831i;2.25500000000000e-07 + 0.00000000000000i,1.94630068361495 + 0.00990368366074909i;2.25500000000000e-07 + 0.00000000000000i,1.94630068361495 + 0.00990368366074909i;2.26000000000000e-07 + 0.00000000000000i,1.95034435138360 + 0.00990579248819667i;2.26000000000000e-07 + 0.00000000000000i,1.95034435138360 + 0.00990579248819667i;2.26500000000000e-07 + 0.00000000000000i,1.95435534442146 + 0.00990771146026480i;2.26500000000000e-07 + 0.00000000000000i,1.95435534442146 + 0.00990771146026480i;2.27000000000000e-07 + 0.00000000000000i,1.95834032345763 + 0.00990959865269016i;2.27000000000000e-07 + 0.00000000000000i,1.95834032345763 + 0.00990959865269016i;2.27500000000000e-07 + 0.00000000000000i,1.96230079724003 + 0.00991146492603974i;2.27500000000000e-07 + 0.00000000000000i,1.96230079724003 + 0.00991146492603974i;2.28000000000000e-07 + 0.00000000000000i,1.96623907785765 + 0.00991339518812970i;2.28000000000000e-07 + 0.00000000000000i,1.96623907785765 + 0.00991339518812970i;2.28500000000000e-07 + 0.00000000000000i,1.97014844620187 + 0.00991520314955417i;2.28500000000000e-07 + 0.00000000000000i,1.97014844620187 + 0.00991520314955417i;2.29000000000000e-07 + 0.00000000000000i,1.97403153002892 + 0.00991699089645326i;2.29000000000000e-07 + 0.00000000000000i,1.97403153002892 + 0.00991699089645326i;2.29500000000000e-07 + 0.00000000000000i,1.97789384975242 + 0.00991876140569993i;2.29500000000000e-07 + 0.00000000000000i,1.97789384975242 + 0.00991876140569993i;2.30000000000000e-07 + 0.00000000000000i,1.98172409299186 + 0.00992034125709451i;2.30000000000000e-07 + 0.00000000000000i,1.98172409299186 + 0.00992034125709451i;2.30500000000000e-07 + 0.00000000000000i,1.98553345555483 + 0.00992202420924759i;2.30500000000000e-07 + 0.00000000000000i,1.98553345555483 + 0.00992202420924759i;2.31000000000000e-07 + 0.00000000000000i,1.98931782139653 + 0.00992359967877896i;2.31000000000000e-07 + 0.00000000000000i,1.98931782139653 + 0.00992359967877896i;2.31500000000000e-07 + 0.00000000000000i,1.99308020110366 + 0.00992523639597276i;2.31500000000000e-07 + 0.00000000000000i,1.99308020110366 + 0.00992523639597276i;2.32000000000000e-07 + 0.00000000000000i,1.99681963207199 + 0.00992687366494967i;2.32000000000000e-07 + 0.00000000000000i,1.99681963207199 + 0.00992687366494967i;2.32500000000000e-07 + 0.00000000000000i,2.00053032479598 + 0.00992830893932219i;2.32500000000000e-07 + 0.00000000000000i,2.00053032479598 + 0.00992830893932219i;2.33000000000000e-07 + 0.00000000000000i,2.00422367012446 + 0.00992987703560267i;2.33000000000000e-07 + 0.00000000000000i,2.00422367012446 + 0.00992987703560267i;2.33500000000000e-07 + 0.00000000000000i,2.00789066310132 + 0.00993132037532686i;2.33500000000000e-07 + 0.00000000000000i,2.00789066310132 + 0.00993132037532686i;2.34000000000000e-07 + 0.00000000000000i,2.01153596086931 + 0.00993278591273584i;2.34000000000000e-07 + 0.00000000000000i,2.01153596086931 + 0.00993278591273584i;2.34500000000000e-07 + 0.00000000000000i,2.01515686657766 + 0.00993413860633171i;2.34500000000000e-07 + 0.00000000000000i,2.01515686657766 + 0.00993413860633171i;2.35000000000000e-07 + 0.00000000000000i,2.01875767364181 + 0.00993551973568348i;2.35000000000000e-07 + 0.00000000000000i,2.01875767364181 + 0.00993551973568348i;2.35500000000000e-07 + 0.00000000000000i,2.02233388253546 + 0.00993683053121464i;2.35500000000000e-07 + 0.00000000000000i,2.02233388253546 + 0.00993683053121464i;2.36000000000000e-07 + 0.00000000000000i,2.02589182554168 + 0.00993823731817167i;2.36000000000000e-07 + 0.00000000000000i,2.02589182554168 + 0.00993823731817167i;2.36500000000000e-07 + 0.00000000000000i,2.02942300855579 + 0.00993947502119989i;2.36500000000000e-07 + 0.00000000000000i,2.02942300855579 + 0.00993947502119989i;2.37000000000000e-07 + 0.00000000000000i,2.03293420251290 + 0.00994070171232228i;2.37000000000000e-07 + 0.00000000000000i,2.03293420251290 + 0.00994070171232228i;2.37500000000000e-07 + 0.00000000000000i,2.03642702082201 + 0.00994200591893810i;2.37500000000000e-07 + 0.00000000000000i,2.03642702082201 + 0.00994200591893810i;2.38000000000000e-07 + 0.00000000000000i,2.03989730842826 + 0.00994325850807358i;2.38000000000000e-07 + 0.00000000000000i,2.03989730842826 + 0.00994325850807358i;2.38500000000000e-07 + 0.00000000000000i,2.04334590809137 + 0.00994442645353850i;2.38500000000000e-07 + 0.00000000000000i,2.04334590809137 + 0.00994442645353850i;2.39000000000000e-07 + 0.00000000000000i,2.04677129026443 + 0.00994555137251046i;2.39000000000000e-07 + 0.00000000000000i,2.04677129026443 + 0.00994555137251046i;2.39500000000000e-07 + 0.00000000000000i,2.05017971975057 + 0.00994671284115112i;2.39500000000000e-07 + 0.00000000000000i,2.05017971975057 + 0.00994671284115112i;2.40000000000000e-07 + 0.00000000000000i,2.05356651019788 + 0.00994783489713443i;2.40000000000000e-07 + 0.00000000000000i,2.05356651019788 + 0.00994783489713443i;2.40500000000000e-07 + 0.00000000000000i,2.05693294432279 + 0.00994894610592485i;2.40500000000000e-07 + 0.00000000000000i,2.05693294432279 + 0.00994894610592485i;2.41000000000000e-07 + 0.00000000000000i,2.06027519336220 + 0.00994989606459589i;2.41000000000000e-07 + 0.00000000000000i,2.06027519336220 + 0.00994989606459589i;2.41500000000000e-07 + 0.00000000000000i,2.06360290190644 + 0.00995096987401625i;2.41500000000000e-07 + 0.00000000000000i,2.06360290190644 + 0.00995096987401625i;2.42000000000000e-07 + 0.00000000000000i,2.06690971848466 + 0.00995199884904657i;2.42000000000000e-07 + 0.00000000000000i,2.06690971848466 + 0.00995199884904657i;2.42500000000000e-07 + 0.00000000000000i,2.07019841306035 + 0.00995306399735663i;2.42500000000000e-07 + 0.00000000000000i,2.07019841306035 + 0.00995306399735663i;2.43000000000000e-07 + 0.00000000000000i,2.07346427417977 + 0.00995398332416480i;2.43000000000000e-07 + 0.00000000000000i,2.07346427417977 + 0.00995398332416480i];
d = Data(:,1);
neff = (Data(:,2));
perm = neff.^2;


figure;
yyaxis right;
plot(d*1e9,abs(real(neff)));
set(gcf, 'Position', [00, 00, 400, 300]);
ylabel('Real index');
xlabel('Waveguide width');
yyaxis left;
hold on;
plot(d*1e9,imag(neff));
ylabel('Imaginary index');
xlabel('Waveguide width');
legend(["Imaginary Index","Real Index"])

k0 = 2*pi/1550e-5;
L = 20e-6;
M = 300;
ne = 2.7;
z = -L/2:(L/(M - 1)):L/2;
wz = 2*ne*z/L;
permz = wz.^2;
figure;
plot(z,permz);

for ind = 1:1:M
    [~,inx] = min(abs((real(permz(ind) - perm)))); 
    d_Al(ind) = d(inx); 
    eps(ind) = perm(inx); 
end

figure;yyaxis left;
plot(z*1e6,real(eps));
set(gcf, 'Position', [00, 00, 400, 300]);
xlabel('x(\mum)');
ylabel('Re[\epsilon]');
yyaxis right
plot(z*1e6,imag(eps));
set(gcf, 'Position', [00, 00, 400, 300]);
xlabel('x(\mum)');
ylabel('Im[\epsilon]');

figure;
plot(z*1e6,d_Al*1e9);
set(gcf, 'Position', [00, 00, 400, 300]);
xlabel('x(\mum)');
ylabel('Waveguide width(nm)')

figure;
plot(z,imag(eps))

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%For Comsol Geometry
a = 0.181/0.161 - 1;
% a = 0.161/0.161 - 1;
gc = -a*(abs(2*z/L)).^2 + a + 1;
Al_Y = [d_Al.*gc*1e6 -d_Al.*gc*1e6]/2;
Al_Y_h = Al_Y';
Al_Z = [z -z]*1e6;
Al_Z_h = Al_Z';
% Al_Y = [d_Al-0.0e-6 -d_Al+0.0e-6]/2*1e6;Al_Z = [z -z]*1e6;
% PumpSweep = unique(Lx_Al_Com)*1e9;
SiO_Y = [d_Al + 140e-9 -d_Al - 140e-9]/2*1e6;
SiO_Z = [z -z];


% % %%%%3.3^2 +(0.03*exp(-((z-5.168[um])/2[um])^2) + 0.03*exp(-((z+5.168[um])/2[um])^2) + 0.017*exp(-(z/10[um])^2))*i
% % tm = 0.03*exp(-((z-5.168e-6)/2e-6).^2) + 0.03*exp(-((z+5.168e-6)/2e-6).^2) + 0.017*exp(-(z/10e-6).^2);
% % figure
% % plot(z,tm)